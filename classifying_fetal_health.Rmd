---
title: "DATA 502 Project"
output: html_document
date: "2023-11-30"
---
```{r}

library(tibble)
data <- read.csv("/Users/jonathansedaka/Downloads/fetal_health.csv")
data <- tibble(data)

colnames(data) # list all features/variables

# removing unhelpful features:

data <- data[, c(1:11, 22)]
data

# abnormal_short_term_variability vs. mean_value_of_short_term_variability - drop one?
# percentage_of_time_with_abnormal_long_term_variability vs. mean_value_of_long_term_variability - drop one?

# some kind of initial analysis before decision trees? logistic regression for 3 classes?

# install and load required packages:

install.packages("randomForest")
install.packages("party")
library(randomForest)

# change class column values for classification model, instead of regression model

data$fetal_health[data$fetal_health == 1] <- "Normal"
data$fetal_health[data$fetal_health == 2] <- "Suspect"
data$fetal_health[data$fetal_health == 3] <- "Pathological"

data$fetal_health <- as.factor(data$fetal_health)
# https://stackoverflow.com/questions/33266992/how-to-set-classification-type-for-a-random-forest-in-r

forest.output <- randomForest(fetal_health ~ ., data = data) #importance = TRUE, proximity = TRUE)

forest.output # model accuracy is about 94%

labs <- c("OOB", "Normal", "Pathological", "Suspect")
cols <- c("black", "darkgreen", "red", "gold")

label_cols <- data.frame("labels" = labs, "colors" = cols)

plot(forest.output, main = "Error Rates Based on # of Trees", col = label_cols$colors)


forest.output$err.rate

?plot

# trying 4 variables for each tree:

forest.output2 <- randomForest(fetal_health ~ ., data = data, mtry = 4)
forest.output2

# Plotting the Random Forest model (forest.output2)
plot(forest.output2, col = c("black", "red", "blue", "yellow"), 
     main = "Error Rates for Different Number of Trees (mtry = 4)")


```

Exploratory Data Analysis
```{r}
library(dplyr)
library(knitr)

# Summary Statistics
summary(data)
summary_stats <- data %>% 
  summarise(across(where(is.numeric), list(min = min, q1 = ~quantile(., 0.25), 
                                           median = median, mean = mean, 
                                           q3 = ~quantile(., 0.75), max = max)))

# Display the summary statistics in a nicer format 
kable(summary_stats)

# Correlation Analysis
correlation_matrix <- cor(data[, sapply(data, is.numeric)])
print(correlation_matrix)

# Data Visualization
library(ggplot2)

# Calculate correlation matrix
numeric_data <- data[, sapply(data, is.numeric)]
cor_matrix <- cor(numeric_data, use = "complete.obs")

cor_melted <- reshape2::melt(cor_matrix)

# Create heatmap
ggplot(cor_melted, aes(Var1, Var2, fill = value)) +
    geom_tile(color = "white") +
    scale_fill_gradient2(low = "blue", high = "red", mid = "white", midpoint = 0, limit = c(-1, 1)) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          axis.title.x = element_blank(),
          axis.title.y = element_blank()) +
    labs(fill = "Correlation")

library(gridExtra)
# Get all numeric features
numeric_features <- names(data)[sapply(data, is.numeric)]

# Loop to create plots for each feature
for (feature in numeric_features) {
    # Histogram
    hist_plot <- ggplot(data, aes_string(x = feature)) +
                 geom_histogram(bins = 30, fill = "blue", color = "black") +
                 labs(title = paste("Histogram of", feature), x = feature, y = "Count") +
                 theme_minimal() +
                 theme(plot.margin = margin(5, 5, 5, 5)) 

    # Box Plot
    box_plot <- ggplot(data, aes_string(x = "fetal_health", y = feature, fill = "fetal_health")) +
                geom_boxplot() +
                labs(title = paste("Box Plot of", feature, "by Fetal Health Class"), x = "Fetal Health Class", y = feature) +
                theme_minimal() +
                theme(plot.margin = margin(5, 5, 5, 5)) 

    # Combine plots and display with space
    grid.arrange(hist_plot, box_plot, ncol = 2,
                 top = feature, 
                 widths = c(1, 1), 
                 padding = unit(1, "lines"))
}
```

Multinomial Logistic Regression Comparison
```{r}
library(nnet)
# Splitting data into training and testing sets 
set.seed(123)  
train_indices <- sample(1:nrow(data), size = 0.75 * nrow(data))
train_data <- data[train_indices, ]
test_data <- data[-train_indices, ]

# Fitting a multinomial logistic regression model
multinom_model <- multinom(fetal_health ~ ., data = train_data)

# Summary of the model
summary(multinom_model)

# Predicting on the test set
predictions <- predict(multinom_model, newdata = test_data)

# Evaluating the model
conf_matrix <- table(test_data$fetal_health, predictions)
accuracy <- sum(diag(conf_matrix)) / sum(conf_matrix)
print(paste("Accuracy:", accuracy))

print(conf_matrix)

summary_model <- summary(multinom_model)

# Calculate p-values
p_values <- (1 - pnorm(abs(z_values))) * 2

# Display the p-values
print(p_values)

```



